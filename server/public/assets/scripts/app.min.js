/*! parking_app 2015-06-02 */
var app=angular.module("app",[]);app.controller("IndexController",["$scope","$http","$sce","geolocation",function(a,b,c,d){a.auth=!1,a.tab=1,a.logIn=function(){console.log("Clicked! sending request",a.login),b.post("/users/login",a.login).success(function(){e()})},a.spot={};var e=function(){b.get("/users/username").success(function(b){console.log("user data is",b),0!=b&&(a.user=b,a.auth=!0)})};console.log("Current user is ",a.user);a.saveSpot=function(){return console.log("Saving spot",a.spot),b.post("/spot",a.spot)},a.park=function(){g().then(function(){map.addPin()},function(a){h(a)},function(a){i(a)}).then(function(){a.saveSpot()},function(a){h(a)},function(a){i(a)})};var f=function(b){return console.log("set position",b),a.spot._id=a.user.username,a.spot.created=new Date,a.spot.latitude=b.coords.latitude,a.spot.longitude=b.coords.longitude,console.log("spot set to",a.spot),map.setView([a.spot.latitude,a.spot.longitude],15),!0},g=function(){var a=d.getLocation();return a.then(function(a){f(a)},function(a){h(a)},function(a){i(a)}),a},h=function(a){console.log("Failed: ",a),next(a)},i=function(a){console.log("Update: ",a)};a.mapStyle={width:"100%"}}]);