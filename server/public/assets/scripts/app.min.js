/*! parking_app 2015-06-02 */
var app=angular.module("app",[]);app.controller("IndexController",["$scope","$http","$sce","geolocation",function(a,b,c,d){function e(){var b=new google.maps.LatLng(a.spot.latitude,a.spot.longitude);j=new google.maps.Map(document.getElementById("map-canvas"),{zoom:13,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP}),l.setMap(j)}a.auth=!1,a.tab=1,a.logIn=function(){console.log("Clicked! sending request",a.login),b.post("/users/login",a.login).success(function(){f()})},a.spot={};var f=function(){b.get("/users/username").success(function(b){console.log("user data is",b),0!=b&&(a.user=b,a.auth=!0)})};console.log("Current user is ",a.user);var g=function(){return console.log("Saving spot",a.spot),b.post("/spot",a.spot)};a.park=function(){i(),n(),g()};var h=function(b){return console.log("set position",b),a.user&&(a.spot._id=a.user.username),a.spot.created=new Date,a.spot.latitude=b.coords.latitude,a.spot.longitude=b.coords.longitude,console.log("spot set to",a.spot),null==j&&e(),!0},i=function(){if(navigator.geolocation)return navigator.geolocation.getCurrentPosition(h);throw new Error("In-browser geolocation not supported")};a.mapStyle={width:"100%"};var j,k=new google.maps.DirectionsService,l=new google.maps.DirectionsRenderer,m=new google.maps.Marker;google.maps.event.addDomListener(window,"load",i);var n=function(){m.setMap(null),m=new google.maps.Marker({position:new google.maps.LatLng(a.spot.latitude,a.spot.longitude),draggable:!0,title:"Parking Spot"}),m.setMap(j)};a.getDirections=function(){k.route({origin:new google.maps.LatLng(a.spot.latitude,a.spot.longitude),destination:m.position,travelMode:google.maps.TravelMode.WALKING},function(a,b){b==google.maps.DirectionsStatus.OK&&(console.log(a),l.setDirections(a),l.setPanel(angular.element.find("directionsPanel")))})}}]);