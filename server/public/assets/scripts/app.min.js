/*! parking_app 2015-06-02 */
var app=angular.module("app",[]);app.controller("IndexController",["$scope","$http",function(a,b){function c(){var b=new google.maps.LatLng(a.spot.latitude,a.spot.longitude);h=new google.maps.Map(document.getElementById("map-canvas"),{zoom:13,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP}),j.setMap(h)}a.auth=!1,a.tab=1,a.logIn=function(){console.log("Clicked! sending request",a.login),b.post("/users/login",a.login).success(function(){d()})},a.spot={};var d=function(){b.get("/users/username").success(function(b){console.log("user data is",b),0!=b&&(a.user=b,a.auth=!0)})};console.log("Current user is ",a.user);var e=function(){return console.log("Saving spot",a.spot),b.post("/spot",a.spot)};a.park=function(){g(),l(),e()};var f=function(b){return console.log("set position",b),a.user&&(a.spot._id=a.user.username),a.spot.created=new Date,a.spot.latitude=b.coords.latitude,a.spot.longitude=b.coords.longitude,console.log("spot set to",a.spot),null==h&&c(),!0},g=function(){if(navigator.geolocation)return navigator.geolocation.getCurrentPosition(f);throw new Error("In-browser geolocation not supported")};a.mapStyle={width:"100%"};var h,i=new google.maps.DirectionsService,j=new google.maps.DirectionsRenderer,k=new google.maps.Marker;google.maps.event.addDomListener(window,"load",g);var l=function(){k.setMap(null),k=new google.maps.Marker({position:new google.maps.LatLng(a.spot.latitude,a.spot.longitude),draggable:!0,title:"Parking Spot"}),k.setMap(h)};a.getDirections=function(){var b=document.getElementById("directionsPanel");i.route({origin:new google.maps.LatLng(a.spot.latitude,a.spot.longitude),destination:k.position,travelMode:google.maps.TravelMode.WALKING},function(a,c){c==google.maps.DirectionsStatus.OK&&(console.log(a),j.setDirections(a),j.setPanel(b),console.log("directionsDisplay",j))})}}]);